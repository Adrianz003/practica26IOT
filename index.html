<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Monitoreo de Temperatura y Control de LED</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="raphael-2.1.4.min.js"></script>
    <script src="justgage.js"></script>

    <style>
        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            font-family: Arial, sans-serif;
            text-align: center;
            transition: background-color 0.5s;
            margin-top: 50px;
        }
        .gauge-container {
            width: 300px;
            margin: 20px;
        }
        button {
            padding: 10px 20px;
            font-size: 16px;
            margin: 5px;
            cursor: pointer;
        }
    </style>

    <script>
        const accessToken = "4575c31f1e1aa26d938b67b8e9698690af427cdc";
        const deviceID = "0a10aced202194944a058ae4";
        const urlC = 'https://api.particle.io/v1/devices/${deviceID}/tempC';
        const urlF = 'https://api.particle.io/v1/devices/${deviceID}/tempF';
        const urlLed = 'https://api.particle.io/v1/devices/${deviceID}/led';

        function updateGauges(dataC, dataF) {
            if (dataC && dataF) {
                const tempC = parseFloat(dataC.result).toFixed(2);
                const tempF = parseFloat(dataF.result).toFixed(2);

                document.body.style.backgroundColor = tempC < 20 ? "#a3c9ff" : (tempC < 40 ? "#ffc107" : "#f44336");
                gaugeC.refresh(tempC);
                gaugeF.refresh(tempF);

                setTimeout(fetchTemperature, 1000);
            } else {
                alert("Error al obtener los datos");
            }
        }

        function fetchTemperature() {
            $.when(
                $.get(urlC, { access_token: accessToken }),
                $.get(urlF, { access_token: accessToken })
            ).done((dataC, dataF) => updateGauges(dataC[0], dataF[0]))
              .fail(() => alert("Error al conectar con el dispositivo"));
        }

        function cambiarLed(estado) {
            fetch(urlLed, {
                method: 'POST',
                headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                body: access_token=${accessToken}&params=${estado}
            })
            .then(response => response.json())
            .then(data => {
                const message = estado === 'on' ? 'encendido' : 'apagado';
                alert(LED ${message} correctamente.);
            })
            .catch(error => console.error('Error:', error));
        }
    </script>
</head>

<body onload="fetchTemperature()">
    <h1>Monitoreo de Temperatura y Control de LED</h1>

    <button onclick="cambiarLed('on')">Encender LED</button>
    <button onclick="cambiarLed('off')">Apagar LED</button>
    <div class="gauge-container">
        <h2>Temperatura (째C)</h2>
        <div id="gaugeC" style="height:250px; width:250px;"></div>
    </div>
    <div class="gauge-container">
        <h2>Temperatura (째F)</h2>
        <div id="gaugeF" style="height:250px; width:250px;"></div>
    </div>
    <script>
        const gaugeC = new JustGage({ id: "gaugeC", value: 0, min: 0, max: 50, title: "째C" });
        const gaugeF = new JustGage({ id: "gaugeF", value: 0, min: 32, max: 122, title: "째F" });
    </script>
</body>
</html>
